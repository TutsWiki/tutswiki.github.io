<!DOCTYPE html>
<html lang="en" class="js csstransforms3d">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="generator" content="Hugo 0.69.2" />
    <meta name="description" content="A newbie friendly introduction to REST API in Clojure. Project configuration and request handler.">
<meta name="author" content="Chankey Pathak">

    <link rel="icon" href="/images/favicon.png" type="image/png">

    <title>A REST API in Clojure :: TutsWiki Beta</title>

    
    <link href="/css/nucleus.css?1597074472" rel="stylesheet">
    <link href="/css/fontawesome-all.min.css?1597074472" rel="stylesheet">
    <link href="/css/hybrid.css?1597074472" rel="stylesheet">
    <link href="/css/featherlight.min.css?1597074472" rel="stylesheet">
    <link href="/css/perfect-scrollbar.min.css?1597074472" rel="stylesheet">
    <link href="/css/auto-complete.css?1597074472" rel="stylesheet">
    <link href="/css/atom-one-dark-reasonable.css?1597074472" rel="stylesheet">
    <link href="/css/theme.css?1597074472" rel="stylesheet">
    <link href="/css/hugo-theme.css?1597074472" rel="stylesheet">
    
    

    <script src="/js/jquery-3.3.1.min.js?1597074472"></script>

    <style>
      :root #header + #content > #left > #rlblock_left{
          display:none !important;
      }
      
        :not(pre) > code + span.copy-to-clipboard {
            display: none;
        }
      
    </style>
    
  </head>
  <body class="" data-url="/rest-api-in-clojure/">
    <nav id="sidebar" class="">



  <div id="header-wrapper">
    <div id="header">
      <a href="/"><img src="https://tutswiki.com/img/tutswiki-logo.png" style="width:70%"/></a>
    </div>
    
        <div class="searchbox">
    <label for="search-by"><i class="fas fa-search"></i></label>
    <input data-search-input id="search-by" type="search" placeholder="Search...">
    <span data-search-clear=""><i class="fas fa-times"></i></span>
</div>

<script type="text/javascript" src="/js/lunr.min.js?1597074472"></script>
<script type="text/javascript" src="/js/auto-complete.js?1597074472"></script>
<script type="text/javascript">
    
        var baseurl = "https:\/\/tutswiki.com\/";
    
</script>
<script type="text/javascript" src="/js/search.js?1597074472"></script>

    
  </div>

    <div class="highlightable">
    <ul class="topics">

        
          
          




 
  
    
    <li data-nav-id="/blog/" title="Blog" class="dd-item 
        parent
        
        
        ">
      <a href="/blog/">
          <b></b>Blog
          
      </a>
      
      
        <ul>
          
          
          
          
        
          
            
            




 
  
    
      <li data-nav-id="/approximating-randomness/" title="Approximating Randomness" class="dd-item ">
        <a href="/approximating-randomness/">
        Approximating Randomness
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/convert-python-script-to-module/" title="How to convert a Python script to module" class="dd-item ">
        <a href="/convert-python-script-to-module/">
        How to convert a Python script to module
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/grunt-tutorial-example/" title="Grunt Tutorial with Live Example" class="dd-item ">
        <a href="/grunt-tutorial-example/">
        Grunt Tutorial
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/noprocrast/" title="noprocrast" class="dd-item ">
        <a href="/noprocrast/">
        noprocrast
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/how-to-fix-sudo-node-command-not-found-error/" title="How to fix sudo node command not found error" class="dd-item ">
        <a href="/how-to-fix-sudo-node-command-not-found-error/">
        sudo and node
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/yet-another-lousy-monad-tutorial/" title="Yet another lousy monad tutorial" class="dd-item ">
        <a href="/yet-another-lousy-monad-tutorial/">
        Yet another lousy monad tutorial
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/ruby-enumerable/" title="A Deeper Look at Ruby&#39;s Enumerable" class="dd-item ">
        <a href="/ruby-enumerable/">
        A Deeper Look at Ruby&#39;s Enumerable
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/rest-api-in-clojure/" title="A REST API in Clojure" class="dd-item active">
        <a href="/rest-api-in-clojure/">
        A REST API in Clojure
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/abstract-classes-and-interfaces-in-python/" title="Abstract classes and interfaces in Python" class="dd-item ">
        <a href="/abstract-classes-and-interfaces-in-python/">
        Abstract classes and interfaces in Python
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/deep-learning-cardiovascular-imaging/" title="How Deep Learning Helped Reducing Variability in Cardiovascular Imaging" class="dd-item ">
        <a href="/deep-learning-cardiovascular-imaging/">
        Deep Learning helped reducing variability in Cardiovascular Imaging
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/google-engineers-boycott-security-tool-military/" title="Google Engineers Boycott Against Security Tool for Military" class="dd-item ">
        <a href="/google-engineers-boycott-security-tool-military/">
        Google engineers boycott
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/nodejs-google-app-engine/" title="How to deploy Node.js app on Google App Engine" class="dd-item ">
        <a href="/nodejs-google-app-engine/">
        Node.js on Google App Engine
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/angular6-features/" title="What&#39;s new in Angular 6 (Features List)" class="dd-item ">
        <a href="/angular6-features/">
        Angular 6 features
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/github-alternatives/" title="GitHub Alternatives (Free, Paid, Self-Hosted)" class="dd-item ">
        <a href="/github-alternatives/">
        Github alternatives
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/what-is-the-use-of-yield-in-python/" title="What is the use of yield in Python?" class="dd-item ">
        <a href="/what-is-the-use-of-yield-in-python/">
        What is the use of yield in Python?
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/append-vs-extend-python/" title="Difference between append and extend in Python" class="dd-item ">
        <a href="/append-vs-extend-python/">
        Difference between append and extend in Python
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/print-same-line-python/" title="How to print on same line with print in Python" class="dd-item ">
        <a href="/print-same-line-python/">
        How to print on same line with print in Python
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/read-write-config-files-in-python/" title="Writing and Reading config files in Python" class="dd-item ">
        <a href="/read-write-config-files-in-python/">
        Writing and Reading config files in Python
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/run-module-as-script-python/" title="How to run a Python module as script?" class="dd-item ">
        <a href="/run-module-as-script-python/">
        How to run a Python module as script?
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/if-name-main-in-python/" title="What is if __name__ == &#34;__main__&#34; in Python?" class="dd-item ">
        <a href="/if-name-main-in-python/">
        What is if __name__ == &#34;__main__&#34; in Python?
        
        </a>
    </li>
     
  
 

            
          
        
        </ul>
              
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/pandas-cookbook/" title="Pandas Cookbook" class="dd-item 
        
        
        
        ">
      <a href="/pandas-cookbook/">
          <b></b>Pandas Cookbook
          
      </a>
      
      
        <ul>
          
          
          
          
        
          
            
            




 
  
    
      <li data-nav-id="/pandas-cookbook/chapter1/" title="Chapter 1 - Reading from a CSV" class="dd-item ">
        <a href="/pandas-cookbook/chapter1/">
        Chapter 1
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/pandas-cookbook/chapter2/" title="Chapter 2 - Selecting and finding desired data" class="dd-item ">
        <a href="/pandas-cookbook/chapter2/">
        Chapter 2
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/pandas-cookbook/chapter3/" title="Chapter 3 - Filtering dataframes" class="dd-item ">
        <a href="/pandas-cookbook/chapter3/">
        Chapter 3
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/pandas-cookbook/chapter4/" title="Chapter 4 - Groupby and Aggregate" class="dd-item ">
        <a href="/pandas-cookbook/chapter4/">
        Chapter 4
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/pandas-cookbook/chapter5/" title="Chapter 5 - Web scraping with Pandas" class="dd-item ">
        <a href="/pandas-cookbook/chapter5/">
        Chapter 5
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/pandas-cookbook/chapter6/" title="Chapter 6 - String Operations" class="dd-item ">
        <a href="/pandas-cookbook/chapter6/">
        Chapter 6
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/pandas-cookbook/chapter7/" title="Chapter 7 - Cleanup messy data" class="dd-item ">
        <a href="/pandas-cookbook/chapter7/">
        Chapter 7
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/pandas-cookbook/chapter8/" title="Chapter 8 - Parsing Unix timestamps" class="dd-item ">
        <a href="/pandas-cookbook/chapter8/">
        Chapter 8
        
        </a>
    </li>
     
  
 

            
          
        
        </ul>
              
    </li>
  
 

          
         
    </ul>

    
    
      <section id="shortcuts">
        <h3>More</h3>
        <ul>
          
              <li> 
                  <a class="padding" href="https://github.com/TutsWiki/source/"><i class='fab fa-fw fa-github'></i> GitHub repo</a>
              </li>
          
              <li> 
                  <a class="padding" href="https://github.com/TutsWiki/source/graphs/contributors"><i class='fa fa-fw fa-bullhorn'></i> Credits</a>
              </li>
          
              <li> 
                  <a class="padding" href="https://www.facebook.com/TutsWiki/"><i class='fab fa-fw fa-facebook'></i> Facebook</a>
              </li>
          
        </ul>
      </section>
    

    
    <section id="footer">
      <center>
    
    <a class="github-button" href="https://github.com/TutsWiki/source/" data-icon="octicon-star" data-show-count="true" aria-label="Star TutsWiki/source on GitHub">Star</a>

    
    <a class="github-button" href="https://github.com/TutsWiki/source/fork" data-icon="octicon-repo-forked" data-show-count="true" aria-label="Fork TutsWiki/source on GitHub">Fork</a>

    <p>Built by Community with <a href="https://github.com/TutsWiki/source/graphs/contributors"><i class="fa fa-heart"></i></a>
</center>

<script async defer src="https://buttons.github.io/buttons.js"></script>

    </section>
  </div>
</nav>




        <section id="body">
        <div id="overlay"></div>
        <div class="padding highlightable">
              
              <div>
                <div id="top-bar">
                
                  
                  
                  
                  <div id="top-github-link">
                    <a class="github-link" title='Edit this page' href="https://github.com/TutsWiki/source/edit/master/content/blog/rest-api-in-clojure.md" target="blank">
                      <i class="fas fa-code-branch"></i>
                      <span id="top-github-link-text">Edit this page</span>
                    </a>
                  </div>
                  
                
                
                <div id="breadcrumbs" itemscope="" itemtype="http://data-vocabulary.org/Breadcrumb">
                    <span id="sidebar-toggle-span">
                        <a href="#" id="sidebar-toggle" data-sidebar-toggle="">
                          <i class="fas fa-bars"></i>
                        </a>
                    </span>
                  
                  <span id="toc-menu"><i class="fas fa-list-alt"></i></span>
                  
                  <span class="links">
                 
                 
                    
          
          
            
            
          
          
            
            
          
          
            <a href='/'>TutsWiki Beta</a> > <a href='/blog/'>Blog</a> > A REST API in Clojure
          
        
          
        
          
        
                 
                  </span>
                </div>
                
                    <div class="progress">
    <div class="wrapper">
<nav id="TableOfContents">
<ul>
<li>
<ul>
<li><a href="#creating-the-project-scaffolding">Creating the project scaffolding</a></li>
<li><a href="#project-configuration-project-clj">Project configuration (project.clj)</a></li>
<li><a href="#the-request-handler-handler-clj">The request handler (handler.clj)</a></li>
<li><a href="#the-complete-handler-clj">The complete handler.clj</a></li>
<li><a href="#help-improve-this-content">Help improve this content</a></li>
</ul></li>
</ul>
</nav>
    </div>
</div>

                
              </div>
            </div>
            
        <div id="head-tags">
        
        </div>
        
        <div id="body-inner">
          
            <h1>
              
              A REST API in Clojure
            </h1>
          

        




<p><meta property="og:image" content="https://tutswiki.com/img/tutswiki-logo.png"/>
<meta name="twitter:card" content="summary" />
<meta name="twitter:title" content="A REST API in Clojure" />
<meta name=”twitter:description” content="A newbie friendly introduction to REST API in Clojure." /></p>

<p>Clojure is one of the most interesting new languages targeting the JVM. Initially only the JVM, in the meantime it is also available for JavaScript. Essentially, you can write Clojure and either execute it as Java program or JavaScript program, of course each flavor has its unique features as well.</p>

<p>Clojure is a Lisp, thus the syntax may be foreign, but it is really, really easy since there are very few syntactic variations. The language “Lisp” is very lean and usually easily learned.</p>

<p>In this post, we’re going to create a complete REST application from scratch. There are already some (very) good tutorials available, but some are not quite up to date (see <a href="https://devcenter.heroku.com/articles/clojure-web-application">Heroku’s Devcenter</a> or Mark McGranaghan for good ones). Clojure itself is still a young language, Lisp of course has a lot of history.</p>

<p>Our application should allow creating, listing, fetching, updating, and deleting of documents.</p>

<p>A document looks like this (JSON encoded):</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-json" data-lang="json">{
      <span style="color:#f92672">&#34;id&#34;</span> : <span style="color:#e6db74">&#34;some id&#34;</span>,
      <span style="color:#f92672">&#34;title&#34;</span> : <span style="color:#e6db74">&#34;some title&#34;</span>,
      <span style="color:#f92672">&#34;text&#34;</span> : <span style="color:#e6db74">&#34;some text&#34;</span>
}</code></pre></div>
<ul>
<li>A GET call to /documents should return a list of these documents.</li>
<li>A POST call to /documents with a documents as body shall create a new document, assigning a new id (ignoreing the posted one).</li>
<li>A GET to /documents/[ID] should return the document with the given id, or 404 if the document does not exist.</li>
<li>A PUT to /documents/[ID] should update the document with the given id and replace title and text with those from the document in the uploaded body.</li>
<li>A DELETE to /documents/[ID] should delete the document with the given id and return 204 (NO CONTENT) in any case.</li>
</ul>

<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<ins class="adsbygoogle"
     style="display:block; text-align:center;"
     data-ad-layout="in-article"
     data-ad-format="fluid"
     data-ad-client="ca-pub-9878675755379402"
     data-ad-slot="5842766387"></ins>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script>

<h2 id="creating-the-project-scaffolding">Creating the project scaffolding</h2>

<p>We’re going to use <a href="https://leiningen.org/">Leiningen</a>, the defacto build system and dependency manager for Clojure projects. Download and install it, then execute:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">lein new compojure clojure-rest</code></pre></div>
<p>We’re creating a new <a href="https://github.com/weavejester/compojure/wiki">Compojure</a> project called clojure-rest. Compojure is the library that maps URLs to functions in our program. Compojure (and our project) builds on Ring is the basic Server API. To start the new project run:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">lein ring server</code></pre></div>
<p>This starts the server on localhost:3000 and automatically restarts the server if any of the project files change. Thus, you can leave it running while we develop our application.</p>

<p>The <code>new</code> command generates two very important files for us:</p>

<p><code>project.clj</code> is the project configuration. It states dependencies, the entry point etc. (read the whole documentation on <a href="https://leiningen.org">Leiningen.org</a>, and <code>src/clojure_rest/handler.clj</code> which contains a starting point for our application.</p>

<h2 id="project-configuration-project-clj">Project configuration (project.clj)</h2>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-clojure" data-lang="clojure">(<span style="color:#66d9ef">defproject </span>clojure-rest <span style="color:#e6db74">&#34;0.1.0-SNAPSHOT&#34;</span>
      <span style="color:#e6db74">:description</span> <span style="color:#e6db74">&#34;FIXME: write description&#34;</span>
      <span style="color:#e6db74">:url</span> <span style="color:#e6db74">&#34;http://example.com/FIXME&#34;</span>
      <span style="color:#e6db74">:dependencies</span> [[org.clojure/clojure <span style="color:#e6db74">&#34;1.4.0&#34;</span>]
                     [compojure <span style="color:#e6db74">&#34;1.1.1&#34;</span>]]
      <span style="color:#e6db74">:plugins</span> [[lein-ring <span style="color:#e6db74">&#34;0.7.3&#34;</span>]]
      <span style="color:#e6db74">:ring</span> {<span style="color:#e6db74">:handler</span> clojure-rest.handler/app}
      <span style="color:#e6db74">:profiles</span>
      {<span style="color:#e6db74">:dev</span> {<span style="color:#e6db74">:dependencies</span> [[ring-mock <span style="color:#e6db74">&#34;0.1.3&#34;</span>]]}})
Update the file to look like this<span style="color:#960050;background-color:#1e0010">:</span>

(<span style="color:#66d9ef">defproject </span>clojure-rest <span style="color:#e6db74">&#34;0.1.0-SNAPSHOT&#34;</span>
      <span style="color:#e6db74">:description</span> <span style="color:#e6db74">&#34;REST service for documents&#34;</span>
      <span style="color:#e6db74">:url</span> <span style="color:#e6db74">&#34;https://tutswiki.com&#34;</span>
      <span style="color:#e6db74">:dependencies</span> [[org.clojure/clojure <span style="color:#e6db74">&#34;1.4.0&#34;</span>]
                     [compojure <span style="color:#e6db74">&#34;1.1.1&#34;</span>]
                     [ring/ring-json <span style="color:#e6db74">&#34;0.1.2&#34;</span>]
                     [c3p0/c3p0 <span style="color:#e6db74">&#34;0.9.1.2&#34;</span>]
                     [org.clojure/java.jdbc <span style="color:#e6db74">&#34;0.2.3&#34;</span>]
                     [com.h2database/h2 <span style="color:#e6db74">&#34;1.3.168&#34;</span>]
                     [cheshire <span style="color:#e6db74">&#34;4.0.3&#34;</span>]]
      <span style="color:#e6db74">:plugins</span> [[lein-ring <span style="color:#e6db74">&#34;0.7.3&#34;</span>]]
      <span style="color:#e6db74">:ring</span> {<span style="color:#e6db74">:handler</span> clojure-rest.handler/app}
      <span style="color:#e6db74">:profiles</span>
      {<span style="color:#e6db74">:dev</span> {<span style="color:#e6db74">:dependencies</span> [[ring-mock <span style="color:#e6db74">&#34;0.1.3&#34;</span>]]}})</code></pre></div>
<p>Besides the JSON parsing library <a href="https://github.com/dakrone/cheshire">Cheshire</a>, we added the <a href="https://sourceforge.net/projects/c3p0/">C3P0 Connection Pool</a>, the <a href="https://h2database.com/">H2 Database</a> JDBC driver and Clojure’s <a href="https://github.com/clojure/java.jdbc">java.jdbc</a> contrib-library.</p>

<p>I also updated the <code>:url</code> and <code>:description</code> fields.</p>

<h2 id="the-request-handler-handler-clj">The request handler (handler.clj)</h2>

<p>Next let’s have a look at the generated request handler <code>src/clojure_rest/handler.clj</code>:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-clojure" data-lang="clojure">(<span style="color:#66d9ef">ns </span>clojure-rest.handler
      (<span style="color:#e6db74">:use</span> compojure.core)
      (<span style="color:#e6db74">:require</span> [compojure.handler <span style="color:#e6db74">:as</span> handler]
                [compojure.route <span style="color:#e6db74">:as</span> route]))

    (<span style="color:#a6e22e">defroutes</span> app-routes
      (<span style="color:#a6e22e">GET</span> <span style="color:#e6db74">&#34;/&#34;</span> [] <span style="color:#e6db74">&#34;Hello World&#34;</span>)
      (<span style="color:#a6e22e">route/not-found</span> <span style="color:#e6db74">&#34;Not Found&#34;</span>))

    (<span style="color:#66d9ef">def </span>app
      (<span style="color:#a6e22e">handler/site</span> app-routes))</code></pre></div>
<p>The route <code>GET &quot;/&quot; [] &quot;Hello World&quot;</code> is responsible for our result we saw in the browser. It maps all GET requests to / without parameters to &ldquo;Hello World&rdquo;. The (<code>def app (handler/site app-routes)</code>) part configures our application (registering the routes).</p>

<p>Our first step is to update the configuration. We’re going to work with JSON, so let’s include some Ring middlewares to setup response headers (wrap-json-response) and parse request bodies (<code>wrap-json-body</code>) for us. A middleware is just a wrapper around a handler, thus it can pre- and post-process the whole request/response cycle.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-clojure" data-lang="clojure">(<span style="color:#66d9ef">def </span>app
      (-&gt; (<span style="color:#a6e22e">handler/api</span> app-routes)
        (<span style="color:#a6e22e">middleware/wrap-json-body</span>)
        (<span style="color:#a6e22e">middleware/wrap-json-response</span>)))</code></pre></div>
<p>We switched also from the <code>handler/site</code> template to <code>handler/api</code> which is more appropriate for REST APIs (<a href="https://weavejester.github.com/compojure/compojure.handler.html">documentation</a>).</p>

<p>Next let’s define the routes for our application:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-clojure" data-lang="clojure">(<span style="color:#a6e22e">defroutes</span> app-routes
      (<span style="color:#a6e22e">context</span> <span style="color:#e6db74">&#34;/documents&#34;</span> [] (<span style="color:#a6e22e">defroutes</span> documents-routes
        (<span style="color:#a6e22e">GET</span>  <span style="color:#e6db74">&#34;/&#34;</span> [] (<span style="color:#a6e22e">get-all-documents</span>))
        (<span style="color:#a6e22e">POST</span> <span style="color:#e6db74">&#34;/&#34;</span> {body <span style="color:#e6db74">:body</span>} (<span style="color:#a6e22e">create-new-document</span> body))
        (<span style="color:#a6e22e">context</span> <span style="color:#e6db74">&#34;/:id&#34;</span> [id] (<span style="color:#a6e22e">defroutes</span> document-routes
          (<span style="color:#a6e22e">GET</span>    <span style="color:#e6db74">&#34;/&#34;</span> [] (<span style="color:#a6e22e">get-document</span> id))
          (<span style="color:#a6e22e">PUT</span>    <span style="color:#e6db74">&#34;/&#34;</span> {body <span style="color:#e6db74">:body</span>} (<span style="color:#a6e22e">update-document</span> id body))
          (<span style="color:#a6e22e">DELETE</span> <span style="color:#e6db74">&#34;/&#34;</span> [] (<span style="color:#a6e22e">delete-document</span> id))))))
      (<span style="color:#a6e22e">route/not-found</span> <span style="color:#e6db74">&#34;Not Found&#34;</span>))</code></pre></div>
<p>We define GET and POST for the context &ldquo;/documents, and GET, PUT, DELETE for the context &ldquo;:id&rdquo; on top of that. :id is a placeholder and can then be injected into our parameter vector. The POST and PUT request have a special parameter body for the parsed body (this parameter is provided by the wrap-json-body middleware. For more on routes, take a look at <a href="https://github.com/weavejester/compojure/wiki/Routes-In-Detail">Compojure’s documentation</a>.</p>

<p>Before we define the functions to carry out the requests, let’s fix the imports and open a pool of database connections to work with.</p>

<p>The namespace declaration is used to define which namespaces shall be made available by Clojure.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-clojure" data-lang="clojure">(<span style="color:#66d9ef">ns </span>clojure-rest.handler
      (<span style="color:#e6db74">:import</span> com.mchange.v2.c3p0.ComboPooledDataSource)
      (<span style="color:#e6db74">:use</span> compojure.core)
      (<span style="color:#e6db74">:use</span> cheshire.core)
      (<span style="color:#e6db74">:use</span> ring.util.response)
      (<span style="color:#e6db74">:require</span> [compojure.handler <span style="color:#e6db74">:as</span> handler]
                [ring.middleware.json <span style="color:#e6db74">:as</span> middleware]
                [clojure.java.jdbc <span style="color:#e6db74">:as</span> sql]
                [compojure.route <span style="color:#e6db74">:as</span> route]))</code></pre></div>
<p>We import C3P0’s <code>ComboPooledDataSource</code>, a plain Java class. Next, we fetch the functions defined in <code>compojure.core</code>, <code>cheshire.core</code>, and <code>ring.util.response</code> into our namespace, they can be used without qualifying. Finally we require some more libraries, this time with a qualifier to prevent name clashes or to support nicer separation. I’m not sure when to make the cut between <code>:use</code> and <code>:require</code> yet, so the cut is abitrary.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-clojure" data-lang="clojure">(<span style="color:#66d9ef">def </span>db-config
      {<span style="color:#e6db74">:classname</span> <span style="color:#e6db74">&#34;org.h2.Driver&#34;</span>
       <span style="color:#e6db74">:subprotocol</span> <span style="color:#e6db74">&#34;h2&#34;</span>
       <span style="color:#e6db74">:subname</span> <span style="color:#e6db74">&#34;mem:documents&#34;</span>
       <span style="color:#e6db74">:user</span> <span style="color:#e6db74">&#34;&#34;</span>
       <span style="color:#e6db74">:password</span> <span style="color:#e6db74">&#34;&#34;</span>})</code></pre></div>
<p>Note, we use a in-memory database. If you’d like to keep your database between restarts, you could use <code>:subname &quot;/tmp/documents&quot;</code> for example.</p>

<p>Next we open a pool of connections. C3P0 has no Clojure wrapper, so we deal with Java classes and objects directly (hence a bit more code).</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-clojure" data-lang="clojure">(<span style="color:#66d9ef">defn </span>pool
      [config]
      (<span style="color:#66d9ef">let </span>[cpds (doto (<span style="color:#a6e22e">ComboPooledDataSource.</span>)
                   (<span style="color:#a6e22e">.setDriverClass</span> (<span style="color:#e6db74">:classname</span> config))
                   (<span style="color:#a6e22e">.setJdbcUrl</span> (str <span style="color:#e6db74">&#34;jdbc:&#34;</span> (<span style="color:#e6db74">:subprotocol</span> config) <span style="color:#e6db74">&#34;:&#34;</span> (<span style="color:#e6db74">:subname</span> config)))
                   (<span style="color:#a6e22e">.setUser</span> (<span style="color:#e6db74">:user</span> config))
                   (<span style="color:#a6e22e">.setPassword</span> (<span style="color:#e6db74">:password</span> config))
                   (<span style="color:#a6e22e">.setMaxPoolSize</span> <span style="color:#ae81ff">6</span>)
                   (<span style="color:#a6e22e">.setMinPoolSize</span> <span style="color:#ae81ff">1</span>)
                   (<span style="color:#a6e22e">.setInitialPoolSize</span> <span style="color:#ae81ff">1</span>))]
        {<span style="color:#e6db74">:datasource</span> cpds}))

    (<span style="color:#66d9ef">def </span>pooled-db (<span style="color:#a6e22e">delay</span> (<span style="color:#a6e22e">pool</span> db-config)))

    (<span style="color:#66d9ef">defn </span>db-connection [] <span style="color:#f92672">@</span>pooled-db)</code></pre></div>
<p>Since we deal with a in-memory database, we need to create our table now.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-clojure" data-lang="clojure">(<span style="color:#a6e22e">sql/with-connection</span> (<span style="color:#a6e22e">db-connection</span>)
      (<span style="color:#a6e22e">sql/create-table</span> <span style="color:#e6db74">:documents</span> [<span style="color:#e6db74">:id</span> <span style="color:#e6db74">&#34;varchar(256)&#34;</span> <span style="color:#e6db74">&#34;primary key&#34;</span>]
                                   [<span style="color:#e6db74">:title</span> <span style="color:#e6db74">&#34;varchar(1024)&#34;</span>]
                                   [<span style="color:#e6db74">:text</span> <span style="color:#e6db74">:varchar</span>]))</code></pre></div>
<p>The intent should be easy to understand, for the details take a look at the <a href="https://clojure.github.com/java.jdbc/">java.jdbc documentation</a>. We create a table documents with a :id, :title, and :text column. Note that the database column is called id, not :id.</p>

<p>The only thing missing are the functions to actually perform the actions requested by our clients.</p>

<p>To return a single document with a given id, we could come up with this:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-clojure" data-lang="clojure">(<span style="color:#66d9ef">defn </span>get-document [id]
      (<span style="color:#a6e22e">sql/with-connection</span> (<span style="color:#a6e22e">db-connection</span>)
        (<span style="color:#a6e22e">sql/with-query-results</span> results
          [<span style="color:#e6db74">&#34;select * from documents where id = ?&#34;</span> id]
          (<span style="color:#a6e22e">cond</span>
            (<span style="color:#a6e22e">empty?</span> results) {<span style="color:#e6db74">:status</span> <span style="color:#ae81ff">404</span>}
            <span style="color:#e6db74">:else</span> (<span style="color:#a6e22e">response</span> (first results))))))</code></pre></div>
<p>It reads like this: when called with an id, open a database connection, perform <code>select * from documents where id = ?</code> with the given id as parameter. If the result is empty, return 404, otherwise return the first (and only) document as response.</p>

<p>The response call will convert the document into JSON, this functionality is provided by wrap-json-response, which also sets the correct Content-Type etc.</p>

<p>Another nice one is the creation of new documents:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-clojure" data-lang="clojure">(<span style="color:#66d9ef">defn </span>uuid [] (str (<span style="color:#a6e22e">java.util.UUID/randomUUID</span>)))

    (<span style="color:#66d9ef">defn </span>create-new-document [doc]
      (<span style="color:#66d9ef">let </span>[id (<span style="color:#a6e22e">uuid</span>)]
        (<span style="color:#a6e22e">sql/with-connection</span> (<span style="color:#a6e22e">db-connection</span>)
          (<span style="color:#66d9ef">let </span>[document (assoc doc <span style="color:#e6db74">&#34;id&#34;</span> id)]
            (<span style="color:#a6e22e">sql/insert-record</span> <span style="color:#e6db74">:documents</span> document)))
        (<span style="color:#a6e22e">get-document</span> id)))</code></pre></div>
<p>Here we use Java’s UUID generator (without import, hence the full package name) to generate a new id for each document created. The second let statement is responsible to replace the user-provided id (if any) with our generated one. Remember that Clojure’s datastructures are immutable, so we need to use the document variable thereafter, instead of the doc which still contains the old (or no) id.</p>

<p>Returning the document is delegated to the get-document function.</p>

<h2 id="the-complete-handler-clj">The complete handler.clj</h2>

<p>To round the post up, here is the whole program:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-clojure" data-lang="clojure">(<span style="color:#66d9ef">ns </span>clojure-rest.handler
      (<span style="color:#e6db74">:import</span> com.mchange.v2.c3p0.ComboPooledDataSource)
      (<span style="color:#e6db74">:use</span> compojure.core)
      (<span style="color:#e6db74">:use</span> cheshire.core)
      (<span style="color:#e6db74">:use</span> ring.util.response)
      (<span style="color:#e6db74">:require</span> [compojure.handler <span style="color:#e6db74">:as</span> handler]
                [ring.middleware.json <span style="color:#e6db74">:as</span> middleware]
                [clojure.java.jdbc <span style="color:#e6db74">:as</span> sql]
                [compojure.route <span style="color:#e6db74">:as</span> route]))

    (<span style="color:#66d9ef">def </span>db-config
      {<span style="color:#e6db74">:classname</span> <span style="color:#e6db74">&#34;org.h2.Driver&#34;</span>
       <span style="color:#e6db74">:subprotocol</span> <span style="color:#e6db74">&#34;h2&#34;</span>
       <span style="color:#e6db74">:subname</span> <span style="color:#e6db74">&#34;mem:documents&#34;</span>
       <span style="color:#e6db74">:user</span> <span style="color:#e6db74">&#34;&#34;</span>
       <span style="color:#e6db74">:password</span> <span style="color:#e6db74">&#34;&#34;</span>})

    (<span style="color:#66d9ef">defn </span>pool
      [config]
      (<span style="color:#66d9ef">let </span>[cpds (doto (<span style="color:#a6e22e">ComboPooledDataSource.</span>)
                   (<span style="color:#a6e22e">.setDriverClass</span> (<span style="color:#e6db74">:classname</span> config))
                   (<span style="color:#a6e22e">.setJdbcUrl</span> (str <span style="color:#e6db74">&#34;jdbc:&#34;</span> (<span style="color:#e6db74">:subprotocol</span> config) <span style="color:#e6db74">&#34;:&#34;</span> (<span style="color:#e6db74">:subname</span> config)))
                   (<span style="color:#a6e22e">.setUser</span> (<span style="color:#e6db74">:user</span> config))
                   (<span style="color:#a6e22e">.setPassword</span> (<span style="color:#e6db74">:password</span> config))
                   (<span style="color:#a6e22e">.setMaxPoolSize</span> <span style="color:#ae81ff">1</span>)
                   (<span style="color:#a6e22e">.setMinPoolSize</span> <span style="color:#ae81ff">1</span>)
                   (<span style="color:#a6e22e">.setInitialPoolSize</span> <span style="color:#ae81ff">1</span>))]
        {<span style="color:#e6db74">:datasource</span> cpds}))

    (<span style="color:#66d9ef">def </span>pooled-db (<span style="color:#a6e22e">delay</span> (<span style="color:#a6e22e">pool</span> db-config)))

    (<span style="color:#66d9ef">defn </span>db-connection [] <span style="color:#f92672">@</span>pooled-db)

    (<span style="color:#a6e22e">sql/with-connection</span> (<span style="color:#a6e22e">db-connection</span>)
    <span style="color:#75715e">;  (sql/drop-table :documents) ; no need to do that for in-memory databases</span>
      (<span style="color:#a6e22e">sql/create-table</span> <span style="color:#e6db74">:documents</span> [<span style="color:#e6db74">:id</span> <span style="color:#e6db74">&#34;varchar(256)&#34;</span> <span style="color:#e6db74">&#34;primary key&#34;</span>]
                                   [<span style="color:#e6db74">:title</span> <span style="color:#e6db74">&#34;varchar(1024)&#34;</span>]
                                   [<span style="color:#e6db74">:text</span> <span style="color:#e6db74">:varchar</span>]))

    (<span style="color:#66d9ef">defn </span>uuid [] (str (<span style="color:#a6e22e">java.util.UUID/randomUUID</span>)))

    (<span style="color:#66d9ef">defn </span>get-all-documents []
      (<span style="color:#a6e22e">response</span>
        (<span style="color:#a6e22e">sql/with-connection</span> (<span style="color:#a6e22e">db-connection</span>)
          (<span style="color:#a6e22e">sql/with-query-results</span> results
            [<span style="color:#e6db74">&#34;select * from documents&#34;</span>]
            (into [] results)))))

    (<span style="color:#66d9ef">defn </span>get-document [id]
      (<span style="color:#a6e22e">sql/with-connection</span> (<span style="color:#a6e22e">db-connection</span>)
        (<span style="color:#a6e22e">sql/with-query-results</span> results
          [<span style="color:#e6db74">&#34;select * from documents where id = ?&#34;</span> id]
          (<span style="color:#a6e22e">cond</span>
            (<span style="color:#a6e22e">empty?</span> results) {<span style="color:#e6db74">:status</span> <span style="color:#ae81ff">404</span>}
            <span style="color:#e6db74">:else</span> (<span style="color:#a6e22e">response</span> (first results))))))

    (<span style="color:#66d9ef">defn </span>create-new-document [doc]
      (<span style="color:#66d9ef">let </span>[id (<span style="color:#a6e22e">uuid</span>)]
        (<span style="color:#a6e22e">sql/with-connection</span> (<span style="color:#a6e22e">db-connection</span>)
          (<span style="color:#66d9ef">let </span>[document (assoc doc <span style="color:#e6db74">&#34;id&#34;</span> id)]
            (<span style="color:#a6e22e">sql/insert-record</span> <span style="color:#e6db74">:documents</span> document)))
        (<span style="color:#a6e22e">get-document</span> id)))

    (<span style="color:#66d9ef">defn </span>update-document [id doc]
        (<span style="color:#a6e22e">sql/with-connection</span> (<span style="color:#a6e22e">db-connection</span>)
          (<span style="color:#66d9ef">let </span>[document (assoc doc <span style="color:#e6db74">&#34;id&#34;</span> id)]
            (<span style="color:#a6e22e">sql/update-values</span> <span style="color:#e6db74">:documents</span> [<span style="color:#e6db74">&#34;id=?&#34;</span> id] document)))
        (<span style="color:#a6e22e">get-document</span> id))

    (<span style="color:#66d9ef">defn </span>delete-document [id]
      (<span style="color:#a6e22e">sql/with-connection</span> (<span style="color:#a6e22e">db-connection</span>)
        (<span style="color:#a6e22e">sql/delete-rows</span> <span style="color:#e6db74">:documents</span> [<span style="color:#e6db74">&#34;id=?&#34;</span> id]))
      {<span style="color:#e6db74">:status</span> <span style="color:#ae81ff">204</span>})

    (<span style="color:#a6e22e">defroutes</span> app-routes
      (<span style="color:#a6e22e">context</span> <span style="color:#e6db74">&#34;/documents&#34;</span> [] (<span style="color:#a6e22e">defroutes</span> documents-routes
        (<span style="color:#a6e22e">GET</span>  <span style="color:#e6db74">&#34;/&#34;</span> [] (<span style="color:#a6e22e">get-all-documents</span>))
        (<span style="color:#a6e22e">POST</span> <span style="color:#e6db74">&#34;/&#34;</span> {body <span style="color:#e6db74">:body</span>} (<span style="color:#a6e22e">create-new-document</span> body))
        (<span style="color:#a6e22e">context</span> <span style="color:#e6db74">&#34;/:id&#34;</span> [id] (<span style="color:#a6e22e">defroutes</span> document-routes
          (<span style="color:#a6e22e">GET</span>    <span style="color:#e6db74">&#34;/&#34;</span> [] (<span style="color:#a6e22e">get-document</span> id))
          (<span style="color:#a6e22e">PUT</span>    <span style="color:#e6db74">&#34;/&#34;</span> {body <span style="color:#e6db74">:body</span>} (<span style="color:#a6e22e">update-document</span> id body))
          (<span style="color:#a6e22e">DELETE</span> <span style="color:#e6db74">&#34;/&#34;</span> [] (<span style="color:#a6e22e">delete-document</span> id))))))
      (<span style="color:#a6e22e">route/not-found</span> <span style="color:#e6db74">&#34;Not Found&#34;</span>))

    (<span style="color:#66d9ef">def </span>app
        (-&gt; (<span style="color:#a6e22e">handler/api</span> app-routes)
            (<span style="color:#a6e22e">middleware/wrap-json-body</span>)
            (<span style="color:#a6e22e">middleware/wrap-json-response</span>)))</code></pre></div>
<p>Yeah, the whole program with connection pooling, JSON de/encoding in roughly 90 lines of (admittedly dense) code.</p>

<p>To sum it up: Clojure is fun, concise, and very powerful. Together with the excellent Java integration it ranks very high on my “languages I adore” list.</p>

<h2 id="help-improve-this-content">Help improve this content</h2>

<p>Feel free to <a href="https://github.com/TutsWiki/source/edit/master/content/blog/rest-api-in-clojure.md">edit this page</a> to fix any typos or add more insights.</p>

<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<ins class="adsbygoogle"
     style="display:block; text-align:center;"
     data-ad-layout="in-article"
     data-ad-format="fluid"
     data-ad-client="ca-pub-9878675755379402"
     data-ad-slot="5842766387"></ins>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script>


<footer class="footline">
	
</footer>

        
        </div> 
        

      </div>

    <div id="navigation">
        
        
        
        
            
            
                
                    
                    
                
                

                    
                    
                        
                    
                    

                    
                        
            
            
                
                    
                        
                        
                    
                
                

                    
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                        
                        
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
            
        
        
        


	 
	 
		
			<a class="nav nav-prev" href="/ruby-enumerable/" title="A Deeper Look at Ruby&#39;s Enumerable"> <i class="fa fa-chevron-left"></i></a>
		
		
			<a class="nav nav-next" href="/abstract-classes-and-interfaces-in-python/" title="Abstract classes and interfaces in Python" style="margin-right: 0px;"><i class="fa fa-chevron-right"></i></a>
		
	
    </div>

    </section>
    
    <div style="left: -1000px; overflow: scroll; position: absolute; top: -1000px; border: none; box-sizing: content-box; height: 200px; margin: 0px; padding: 0px; width: 200px;">
      <div style="border: none; box-sizing: content-box; height: 200px; margin: 0px; padding: 0px; width: 200px;"></div>
    </div>
    <script src="/js/clipboard.min.js?1597074472"></script>
    <script src="/js/perfect-scrollbar.min.js?1597074472"></script>
    <script src="/js/perfect-scrollbar.jquery.min.js?1597074472"></script>
    <script src="/js/jquery.sticky.js?1597074472"></script>
    <script src="/js/featherlight.min.js?1597074472"></script>
    <script src="/js/highlight.pack.js?1597074472"></script>
    <script>hljs.initHighlightingOnLoad();</script>
    <script src="/js/modernizr.custom-3.6.0.js?1597074472"></script>
    <script src="/js/learn.js?1597074472"></script>
    <script src="/js/hugo-learn.js?1597074472"></script>

    <link href="/mermaid/mermaid.css?1597074472" rel="stylesheet" />
    <script src="/mermaid/mermaid.js?1597074472"></script>
    <script>
        mermaid.initialize({ startOnLoad: true });
    </script>
    

  </body>
</html>

